!function(e){function n(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function t(e){return"undefined"==typeof e}var r={},i=e.TraceKit,o=[].slice,u="?";r.noConflict=function(){return e.TraceKit=i,r},r.wrap=function(e){function n(){try{return e.apply(this,arguments)}catch(n){throw r.report(n),n}}return n},r.report=function(){function t(e){l(),p.push(e)}function i(e){for(var n=p.length-1;n>=0;--n)p[n]===e&&p.splice(n,1)}function u(e,t){var i=null;if(!t||r.collectWindowErrors){for(var u in p)if(n(p,u))try{p[u].apply(null,[e].concat(o.call(arguments,2)))}catch(c){i=c}if(i)throw i}}function c(e,n,t){var i=null;if(h)r.computeStackTrace.augmentStackTraceWithInitialElement(h,n,t,e),i=h,h=null,g=null;else{var o={url:n,line:t};o.func=r.computeStackTrace.guessFunctionName(o.url,o.line),o.context=r.computeStackTrace.gatherContext(o.url,o.line),i={mode:"onerror",message:e,url:document.location.href,stack:[o],useragent:navigator.userAgent}}return u(i,"from window.onerror"),s?s.apply(this,arguments):!1}function l(){f!==!0&&(s=e.onerror,e.onerror=c,f=!0)}function a(n){var t=o.call(arguments,1);if(h){if(g===n)return;var i=h;h=null,g=null,u.apply(null,[i,null].concat(t))}var c=r.computeStackTrace(n);throw h=c,g=n,e.setTimeout(function(){g===n&&(h=null,g=null,u.apply(null,[c,null].concat(t)))},c.incomplete?2e3:0),n}var s,f,p=[],g=null,h=null;return a.subscribe=t,a.unsubscribe=i,a}(),r.computeStackTrace=function(){function i(n){if(!r.remoteFetching)return"";try{var t=function(){try{return new e.XMLHttpRequest}catch(n){return new e.ActiveXObject("Microsoft.XMLHTTP")}},i=t();return i.open("GET",n,!1),i.send(""),i.responseText}catch(o){return""}}function o(e){if(!n(y,e)){var t="";-1!==e.indexOf(document.domain)&&(t=i(e)),y[e]=t?t.split("\n"):[]}return y[e]}function c(e,n){var r,i=/function ([^(]*)\(([^)]*)\)/,c=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,l="",a=10,s=o(e);if(!s.length)return u;for(var f=0;a>f;++f)if(l=s[n-f]+l,!t(l)){if(r=c.exec(l))return r[1];if(r=i.exec(l))return r[1]}return u}function l(e,n){var i=o(e);if(!i.length)return null;var u=[],c=Math.floor(r.linesOfContext/2),l=c+r.linesOfContext%2,a=Math.max(0,n-c-1),s=Math.min(i.length,n+l-1);n-=1;for(var f=a;s>f;++f)t(i[f])||u.push(i[f]);return u.length>0?u:null}function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function s(e){return a(e).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function f(e,n){for(var t,r,i=0,u=n.length;u>i;++i)if((t=o(n[i])).length&&(t=t.join("\n"),r=e.exec(t)))return{url:n[i],line:t.substring(0,r.index).split("\n").length,column:r.index-t.lastIndexOf("\n",r.index)-1};return null}function p(e,n,t){var r,i=o(n),u=new RegExp("\\b"+a(e)+"\\b");return t-=1,i&&i.length>t&&(r=u.exec(i[t]))?r.index:null}function g(n){for(var t,r,i,o,u=[e.location.href],c=document.getElementsByTagName("script"),l=""+n,p=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,g=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,h=0;h<c.length;++h){var m=c[h];m.src&&u.push(m.src)}if(i=p.exec(l)){var x=i[1]?"\\s+"+i[1]:"",d=i[2].split(",").join("\\s*,\\s*");t=a(i[3]).replace(/;$/,";?"),r=new RegExp("function"+x+"\\s*\\(\\s*"+d+"\\s*\\)\\s*{\\s*"+t+"\\s*}")}else r=new RegExp(a(l).replace(/\s+/g,"\\s+"));if(o=f(r,u))return o;if(i=g.exec(l)){var v=i[1];if(t=s(i[2]),r=new RegExp("on"+v+"=[\\'\"]\\s*"+t+"\\s*[\\'\"]","i"),o=f(r,u[0]))return o;if(r=new RegExp(t),o=f(r,u))return o}return null}function h(e){if(!e.stack)return null;for(var n,t,r=/^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|http|https):.*?):(\d+)(?::(\d+))?\)?\s*$/i,i=/^\s*(\S*)(?:\((.*?)\))?@((?:file|http|https).*?):(\d+)(?::(\d+))?\s*$/i,o=e.stack.split("\n"),a=[],s=/^(.*) is undefined$/.exec(e.message),f=0,g=o.length;g>f;++f){if(n=i.exec(o[f]))t={url:n[3],func:n[1]||u,args:n[2]?n[2].split(","):"",line:+n[4],column:n[5]?+n[5]:null};else{if(!(n=r.exec(o[f])))continue;t={url:n[2],func:n[1]||u,line:+n[3],column:n[4]?+n[4]:null}}!t.func&&t.line&&(t.func=c(t.url,t.line)),t.line&&(t.context=l(t.url,t.line)),a.push(t)}return a[0]&&a[0].line&&!a[0].column&&s&&(a[0].column=p(s[1],a[0].url,a[0].line)),a.length?{mode:"stack",name:e.name,message:e.message,url:document.location.href,stack:a,useragent:navigator.userAgent}:null}function m(e){for(var n,t=e.stacktrace,r=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,i=t.split("\n"),o=[],u=0,a=i.length;a>u;u+=2)if(n=r.exec(i[u])){var s={line:+n[1],column:+n[2],func:n[3]||n[4],args:n[5]?n[5].split(","):[],url:n[6]};if(!s.func&&s.line&&(s.func=c(s.url,s.line)),s.line)try{s.context=l(s.url,s.line)}catch(f){}s.context||(s.context=[i[u+1]]),o.push(s)}return o.length?{mode:"stacktrace",name:e.name,message:e.message,url:document.location.href,stack:o,useragent:navigator.userAgent}:null}function x(t){var r=t.message.split("\n");if(r.length<4)return null;var i,u,a,p,g=/^\s*Line (\d+) of linked script ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,h=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,m=/^\s*Line (\d+) of function script\s*$/i,x=[],d=document.getElementsByTagName("script"),v=[];for(u in d)n(d,u)&&!d[u].src&&v.push(d[u]);for(u=2,a=r.length;a>u;u+=2){var w=null;if(i=g.exec(r[u]))w={url:i[2],func:i[3],line:+i[1]};else if(i=h.exec(r[u])){w={url:i[3],func:i[4]};var E=+i[1],b=v[i[2]-1];if(b&&(p=o(w.url))){p=p.join("\n");var y=p.indexOf(b.innerText);y>=0&&(w.line=E+p.substring(0,y).split("\n").length)}}else if(i=m.exec(r[u])){var k=e.location.href.replace(/#.*$/,""),S=i[1],O=new RegExp(s(r[u+1]));p=f(O,[k]),w={url:k,line:p?p.line:S,func:""}}if(w){w.func||(w.func=c(w.url,w.line));var T=l(w.url,w.line),_=T?T[Math.floor(T.length/2)]:null;w.context=T&&_.replace(/^\s*/,"")===r[u+1].replace(/^\s*/,"")?T:[r[u+1]],x.push(w)}}return x.length?{mode:"multiline",name:t.name,message:r[0],url:document.location.href,stack:x,useragent:navigator.userAgent}:null}function d(e,n,t,r){var i={url:n,line:t};if(i.url&&i.line){e.incomplete=!1,i.func||(i.func=c(i.url,i.line)),i.context||(i.context=l(i.url,i.line));var o=/ '([^']+)' /.exec(r);if(o&&(i.column=p(o[1],i.url,i.line)),e.stack.length>0&&e.stack[0].url===i.url){if(e.stack[0].line===i.line)return!1;if(!e.stack[0].line&&e.stack[0].func===i.func)return e.stack[0].line=i.line,e.stack[0].context=i.context,!1}return e.stack.unshift(i),e.partial=!0,!0}return e.incomplete=!0,!1}function v(e,n){for(var t,i,o,l=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,a=[],s={},f=!1,h=v.caller;h&&!f;h=h.caller)if(h!==w&&h!==r.report){if(i={url:null,func:u,line:null,column:null},h.name?i.func=h.name:(t=l.exec(h.toString()))&&(i.func=t[1]),o=g(h)){i.url=o.url,i.line=o.line,i.func===u&&(i.func=c(i.url,i.line));var m=/ '([^']+)' /.exec(e.message||e.description);m&&(i.column=p(m[1],o.url,o.line))}s[""+h]?f=!0:s[""+h]=!0,a.push(i)}n&&a.splice(0,n);var x={mode:"callers",name:e.name,message:e.message,url:document.location.href,stack:a,useragent:navigator.userAgent};return d(x,e.sourceURL||e.fileName,e.line||e.lineNumber,e.message||e.description),x}function w(e,n){var t=null;n=null==n?0:+n;try{if(t=m(e))return t}catch(r){if(b)throw r}try{if(t=h(e))return t}catch(r){if(b)throw r}try{if(t=x(e))return t}catch(r){if(b)throw r}try{if(t=v(e,n+1))return t}catch(r){if(b)throw r}return{mode:"failed"}}function E(e){e=(null==e?0:+e)+1;try{throw new Error}catch(n){return w(n,e+1)}}var b=!1,y={};return w.augmentStackTraceWithInitialElement=d,w.guessFunctionName=c,w.gatherContext=l,w.ofCaller=E,w}(),function(){var n=function(n){var t=e[n];e[n]=function(){var e=o.call(arguments),n=e[0];return"function"==typeof n&&(e[0]=r.wrap(n)),t.apply?t.apply(this,e):t(e[0],e[1])}};n("setTimeout"),n("setInterval")}(),r.remoteFetching||(r.remoteFetching=!0),r.collectWindowErrors||(r.collectWindowErrors=!0),(!r.linesOfContext||r.linesOfContext<1)&&(r.linesOfContext=11),e.TraceKit=r}(window),function(e,n){"use strict";function t(e,n){var t,r;n=n||{},e="opbeat"+e.substr(0,1).toUpperCase()+e.substr(1),document.createEvent?(t=document.createEvent("HTMLEvents"),t.initEvent(e,!0,!0)):(t=document.createEventObject(),t.eventType=e);for(r in n)l(n,r)&&(t[r]=n[r]);if(document.createEvent)document.dispatchEvent(t);else try{document.fireEvent("on"+t.eventType.toLowerCase(),t)}catch(i){}}function r(e){this.name="OpbeatConfigError",this.message=e}function i(e){return"undefined"==typeof e}function o(e){return"function"==typeof e}function u(e){return"string"==typeof e}function c(e){for(var n in e)return!1;return!0}function l(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function a(e,n){var t,r;if(i(e.length))for(t in e)l(e,t)&&n.call(null,t,e[t]);else if(r=e.length)for(t=0;r>t;t++)n.call(null,t,e[t])}function s(e,n){var r=[];e.stack&&e.stack.length&&a(e.stack,function(e,n){var t=f(n);t&&r.push(t)}),t("handle",{stackInfo:e,options:n}),g(e.name,e.message,e.url,e.lineno,r,n)}function f(e){if(e.url){var n,t={filename:e.url,lineno:e.line,colno:e.column,"function":e.func||"?"},r=p(e);if(r){var i=["pre_context","context_line","post_context"];for(n=3;n--;)t[i[n]]=r[n]}return t.in_app=!(!$.includePaths.test(t.filename)||/(Opbeat|TraceKit)\./.test(t["function"])||/opbeat\.(min\.)?js$/.test(t.filename)),t}}function p(e){if(e.context&&$.fetchContext){for(var n=e.context,t=~~(n.length/2),r=n.length,o=!1;r--;)if(n[r].length>300){o=!0;break}if(o){if(i(e.column))return;return[[],n[t].substr(e.column,50),[]]}return[n.slice(0,t),n[t],n.slice(t+1)]}}function g(e,n,t,r,i,o){var u,c;n+="",("Error"!==e||n)&&($.ignoreErrors.test(n)||(i&&i.length?(t=i[0].filename||t,i.reverse(),u={frames:i}):t&&(u={frames:[{filename:t,lineno:r,in_app:!0}]}),n=m(n,100),$.ignoreUrls&&$.ignoreUrls.test(t)||(!$.whitelistUrls||$.whitelistUrls.test(t))&&(c=r?n+" at "+r:n,d(h({exception:{type:e,value:n},stacktrace:u,culprit:t,message:c},o)))))}function h(e,n){return n?(a(n,function(n,t){e[n]=t}),e):e}function m(e,n){return e.length<=n?e:e.substr(0,n)+"…"}function x(){var e={url:document.location.href,headers:{"User-Agent":navigator.userAgent}};return document.referrer&&(e.headers.Referer=document.referrer),e}function d(e){w()&&(e=h({client_version:"opbeat-js/"+F.VERSION,logger:$.logger,http:x()},e),e.extra=h($.extra,e.extra),c(e.extra)&&delete e.extra,T&&(e.user=T,e.user.is_authenticated=!0),o($.dataCallback)&&(e=$.dataCallback(e)),(!o($.shouldSendCallback)||$.shouldSendCallback(e))&&(S=e.client_supplied_id||(e.client_supplied_id=b()),v(e)))}function v(e){var n=new Image,r=O+"?data="+encodeURIComponent(JSON.stringify(e));n.onload=function(){t("success",{data:e,src:r})},n.onerror=n.onabort=function(){t("failure",{data:e,src:r})},n.src=r}function w(){return C?O?!0:(y("error","Error: Opbeat has not been configured."),!1):!1}function E(e){for(var n,t=[],r=0,i=e.length;i>r;r++)n=e[r],u(n)?t.push(n.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):n&&n.source&&t.push(n.source);return new RegExp(t.join("|"),"i")}function b(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0,t="x"==e?n:3&n|8;return t.toString(16)})}function y(n,t){e.console&&console[n]&&F.debug&&console[n](t)}var k,S,O,T,_=e.Opbeat,C=!(!e.JSON||!e.JSON.stringify),$={api_host:"https://opbeat.com",logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],collectWindowErrors:!0,extra:{}},U=!1,F={VERSION:"0.0.1",debug:!0,noConflict:function(){return e.Opbeat=_,F},config:function(e){return O?(y("error","Error: Opbeat has already been configured"),F):e?(a(e,function(e,n){$[e]=n}),$.ignoreErrors.push("Script error."),$.ignoreErrors.push("Script error"),$.ignoreErrors.push("Javascript error: Script error on line 0"),$.ignoreErrors.push("Javascript error: Script error. on line 0"),$.ignoreErrors=E($.ignoreErrors),$.ignoreUrls=$.ignoreUrls.length?E($.ignoreUrls):!1,$.whitelistUrls=$.whitelistUrls.length?E($.whitelistUrls):!1,$.includePaths=E($.includePaths),O=$.api_host+"/api/v1/organizations/"+$.orgId+"/apps/"+$.appId+"/errors.gif",$.fetchContext&&(TraceKit.remoteFetching=!0),$.linesOfContext&&(TraceKit.linesOfContext=$.linesOfContext),TraceKit.collectWindowErrors=!!$.collectWindowErrors,F):F},install:function(){return w()&&!U&&(TraceKit.report.subscribe(s),U=!0),F},context:function(e,t,r){return o(e)&&(r=t||[],t=e,e=n),F.wrap(e,t).apply(this,r)},wrap:function(e,t){function r(){for(var n=[],r=arguments.length,i=!e||e&&e.deep!==!1;r--;)n[r]=i?F.wrap(e,arguments[r]):arguments[r];try{return t.apply(this,n)}catch(o){throw F.captureException(o,e),o}}if(i(t)&&!o(e))return e;if(o(e)&&(t=e,e=n),!o(t))return t;if(t.__opbeat__)return t;for(var u in t)l(t,u)&&(r[u]=t[u]);return r.__opbeat__=!0,r.__inner__=t,r},uninstall:function(){return TraceKit.report.uninstall(),U=!1,F},captureException:function(e,n){if(!(e instanceof Error))return F.captureMessage(e,n);k=e;try{TraceKit.report(e,n)}catch(t){if(e!==t)throw t}return F},captureMessage:function(e,n){return d(h({message:e+""},n)),F},setUserContext:function(e){return T=e,F},setExtraContext:function(e){return $.extra=e||{},F},lastException:function(){return k},lastEventId:function(){return S}};F.setUser=F.setUserContext,r.prototype=new Error,r.prototype.constructor=r,e.Opbeat=F,"function"==typeof define&&define.amd&&define("opbeat",[],function(){return F})}(this);